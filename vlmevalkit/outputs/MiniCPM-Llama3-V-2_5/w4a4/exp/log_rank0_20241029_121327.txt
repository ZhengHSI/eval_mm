[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp-wikitext/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 12:13:27 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:27 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 12:13:41 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:02 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:02 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:02 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:02 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:02 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 2048
[2024-10-29 12:14:23 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:14:41 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:14:42 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:14:42 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:14:42 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:14:43 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 12:16:24 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:16:36 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:16:43 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:16:44 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:16:44 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:16:46 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:16:46 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 12:17:00 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:17:01 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:17:02 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:17:03 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:17:03 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 12:52:19 LOAD_ENV] (misc.py 173): INFO API Keys successfully loaded from /home/workspace/code/git/eval_mm/vlmevalkit/.env
[2024-10-29 12:52:19 ChatAPI] (gpt.py 114): INFO Environment variable OPENAI_API_BASE is set. Will use it as api_base. 
[2024-10-29 12:52:19 ChatAPI] (gpt.py 129): INFO Using API Base: http://15.204.101.64:4000/v1/chat/completions; API Key: sk-5DjKHIAjndzkjCtb85D57d2c3e13403e95B5D2F02c61561b
[2024-10-29 12:52:21 RUN] (run.py 208): INFO The evaluation of model MiniCPM-Llama3-V-2_5-flatquant x dataset MME has finished! 
[2024-10-29 12:52:21 RUN] (run.py 209): INFO Evaluation Results:
[2024-10-29 12:52:21 RUN] (run.py 215): INFO 
---------------------  --------
perception             1606.9
reasoning               433.929
OCR                     140
artwork                 137.75
celebrity               152.353
code_reasoning           82.5
color                   170
commonsense_reasoning   151.429
count                   180
existence               200
landmark                167.25
numerical_calculation    60
position                138.333
posters                 164.966
scene                   156.25
text_translation        140
---------------------  --------
