[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 root] (minicpm_v.py 584): INFO Arguments: 
[2024-10-29 09:00:08 root] (minicpm_v.py 585): INFO {'a_asym': False,
 'a_bits': 4,
 'a_groupsize': -1,
 'act_order': False,
 'add_diag': True,
 'cache_dir': './outputs/.cache',
 'cali_bsz': 4,
 'cali_dataset': 'wikitext2',
 'cali_trans': True,
 'deactive_amp': False,
 'diag_alpha': 0.3,
 'diag_init': 'sq_style',
 'direct_inv': False,
 'distribute_model': True,
 'epochs': 15,
 'exp_dir': './outputs/MiniCPM-Llama3-V-2_5/w4a4/exp',
 'exp_name': 'exp',
 'flat_lr': 0.005,
 'gptq': False,
 'gptq_mse': False,
 'hf_token': None,
 'k_asym': True,
 'k_bits': 4,
 'k_groupsize': 128,
 'lac': True,
 'lm_eval': False,
 'lm_eval_batch_size': 128,
 'lwc': True,
 'matrix_path': '/home/workspace/code/git/FlatQuant_mlm/outputs/MiniCPM-Llama3-V-2_5/w4a4/exp/',
 'model': '/home/workspace/model/MiniCPM-Llama3-V-2_5',
 'model_name': 'MiniCPM-Llama3-V-2_5',
 'nsamples': 128,
 'output_dir': './outputs',
 'percdamp': 0.01,
 'q_asym': False,
 'q_bits': 16,
 'q_groupsize': -1,
 'reload_matrix': True,
 'resume': False,
 'save_matrix': True,
 'seed': 0,
 'separate_vtrans': False,
 'tasks': ['piqa',
           'hellaswag',
           'arc_easy',
           'arc_challenge',
           'winogrande',
           'lambada_openai'],
 'v_asym': True,
 'v_bits': 4,
 'v_groupsize': 128,
 'w_asym': False,
 'w_bits': 4,
 'w_groupsize': -1,
 'warmup': False}
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 root] (minicpm_v.py 586): INFO ------------------------------------------------------------
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:00:08 transformers_modules.MiniCPM-Llama3-V-2_5.configuration_minicpm] (configuration_minicpm.py 105): INFO vision_config is None, using default vision config
[2024-10-29 09:04:15 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:15 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:15 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:15 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:16 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:16 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:16 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:16 root] (model_utils.py 83): INFO ---> Loading /home/workspace/model/MiniCPM-Llama3-V-2_5 Model with seq_len: 512
[2024-10-29 09:04:53 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:54 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:55 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:55 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:56 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:56 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:56 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:04:56 root] (minicpm_v.py 594): INFO Finished applying FlatQuant to model.
[2024-10-29 09:06:52 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:53 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:55 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:56 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:56 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:57 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:57 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:06:59 root] (minicpm_v.py 597): INFO Finished reparameterize model.
[2024-10-29 09:07:04 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:06 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:09 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:11 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:11 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:12 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:12 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:07:13 root] (utils.py 48): INFO GPU memory (from rtn_fwrd): 0.11 -> 0.11 GB (0.00 GB)
[2024-10-29 09:12:44 LOAD_ENV] (misc.py 173): INFO API Keys successfully loaded from /home/workspace/code/git/eval_mm/vlmevalkit/.env
[2024-10-29 09:12:44 ChatAPI] (gpt.py 114): INFO Environment variable OPENAI_API_BASE is set. Will use it as api_base. 
[2024-10-29 09:12:44 ChatAPI] (gpt.py 129): INFO Using API Base: http://15.204.101.64:4000/v1/chat/completions; API Key: sk-5DjKHIAjndzkjCtb85D57d2c3e13403e95B5D2F02c61561b
[2024-10-29 09:13:02 RUN] (run.py 208): INFO The evaluation of model MiniCPM-Llama3-V-2_5-flatquant x dataset MME has finished! 
[2024-10-29 09:13:02 RUN] (run.py 209): INFO Evaluation Results:
[2024-10-29 09:13:02 RUN] (run.py 215): INFO 
---------------------  --------
perception             1546.7
reasoning               388.571
OCR                     140
artwork                 140.5
celebrity               135
code_reasoning           57.5
color                   165
commonsense_reasoning   128.571
count                   175
existence               190
landmark                146.25
numerical_calculation    47.5
position                145
posters                 160.204
scene                   149.75
text_translation        155
---------------------  --------
